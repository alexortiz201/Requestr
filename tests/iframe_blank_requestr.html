<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <script type="text/javascript">
        var start, managerLoaded;
        // Used to test loading time performance, not supported by all browsers.
        if (window.performance && window.performance.now) {
          start = window.performance.now();
        }
        // Loads the document after Requestr is ready.
        window.addEventListener('requestrReady', function() {
          if (window.performance && window.performance.now) {
            managerLoaded = window.performance.now();
            console.log('Manager App and Requestr loaded in: ' + ((managerLoaded - start)/1000) + ' seconds');
          }
          // Setting the source of the iFrame after parsed by Requestr.
          function handlePageBlobUrl (result) {
            var appFrame = document.getElementById('app');
            // Hack for IE which doesn't support document blob URLs.
            if (Requestr.browser.ieInternetExplorer) {
              appFrame.contentWindow.document.documentElement.innerHTML = result.html;
            } else {
              // Webkit and Firefox
              appFrame.src = result.url;
            }
          }
          // Handling Requestr events for loading UI.
          Requestr.onEvent = function (e) {
            type = e.type;
            if (type === Requestr.customEvents.DOCUMENT_BLOB_URL_CREATED) {
              // Document ready, so used to measure performance.
              if (window.performance && window.performance.now) {
                console.log('iFrame App loaded in: ' + ((window.performance.now() - managerLoaded)/1000) + ' seconds');
              }
            }
          };
          // Loading the document, can do cross-domain as well.
          Requestr.loadPage('/tests/data/index.html', handlePageBlobUrl);
          //Requestr.loadPage('http://www.bbc.com/', handlePageBlobUrl);
        }, false);
      </script>
      <script type="text/javascript">
        "undefined"!=typeof window&&(window.Requestr||(!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}window.CustomEvent&&(a.prototype=window.CustomEvent.prototype),window.CustomEvent=a}(),function(){"use strict";window.URL=window.URL||window.webkitURL,window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB);var a=window.Requestr={};a.LOADING_CLASS="requestr",a.ELEMENTS_QUERY='[rel~="stylesheet"][href], [rel~="icon"][href], [src]',a.SERIALIZATION_QUERY='script[type="text/requestr-serialization"]',a.JS_ELEMENT_ATTRIBUTE="data-requestr-js",a.ORIGINAL_URL_ATTRIBUTE="data-requestr-url",a.DEFAULT_SERVICE_FILE_MAX_SIZE=4e4,a.serialization=document.querySelector(a.SERIALIZATION_QUERY),a.onEvent=null,a.urlParsingEnabledElement={IMG:!0,LINK:!0,SCRIPT:!0},a.matchUrlPattern=new RegExp("(\\b(?:(?:https?|ftp|file|[A-Za-z]+):\\/\\/|www\\.|ftp\\.)(?:\\([-A-Z0-9+&@#\\/%=~_|$?!:,.]*\\)|[-A-Z0-9+&@#\\/%=~_|$?!:,.])*(?:\\([-A-Z0-9+&@#\\/%=~_|$?!:,.]*\\)|[A-Z0-9+&@#\\/%=~_|$]))","gi"),a.resolvedUrls=[],a.thirdParty={},a.browser={userAgent:navigator.userAgent.toLowerCase()},a.browser.isSafari=a.browser.userAgent.indexOf("safari")>-1,a.browser.isFirefox=a.browser.userAgent.indexOf("firefox")>-1,a.browser.ieInternetExplorer=a.browser.userAgent.indexOf("msie")>-1,a.customEvents={REQUESTR_READY:"requestrReady",REQUESTR_ERROR:"requestrError",DOCUMENT_LOAD_START:"documentLoadStart",DOCUMENT_LOAD_PROGRESS:"documentLoadProgress",DOCUMENT_LOAD_ERROR:"documentLoadError",DOCUMENT_LOAD_COMPLETE:"documentLoadComplete",DOCUMENT_RENDERED:"documentRendered",DOCUMENT_BLOB_URL_CREATED:"documentBlobUrlCreated",RESOURCE_API_ERROR:"resourceApiError",RESOURCE_LOAD_START:"resourceLoadStart",RESOURCE_LOAD_PROGRESS:"resourceLoadProgress",RESOURCE_LOAD_ERROR:"resourceLoadError",RESOURCE_LOAD_COMPLETE:"resourceLoadComplete",RESOURCE_RESOLVING:"resourceResolving",EXTERNAL_CSS_LOAD_START:"externalCssLoadStart",EXTERNAL_CSS_LOAD_COMPLETE:"externalCssLoadComplete",EXTERNAL_CSS_LOAD_PROGRESS:"externalCssLoadProgress",EXTERNAL_CSS_LOAD_ERROR:"externalCssLoadError"},a.customErrors={CACHING:"caching",SERIALIZATION:"serialization",SERVICE:"service"},a.CACHING_DB_NAME="Requestr",a.CACHING_DB_STORE_NAME="datauris",a.CACHING_DB_STORE_KEY="url",a.CACHING_DB_VERSION=1,a.localDb=null,a.localDbPolyfill=null,a.resourcesToCache=[],a.resourcesFetchedFromCache=[],a.cache={expires:null,pollyfill:{websql:{}}},a.WEBSQL_DEFAULT_SIZE=2621440,a.dispatchCustomEvent=function(b,c){"function"==typeof a.onEvent&&a.onEvent(c?new CustomEvent(b,{detail:c}):new CustomEvent(b))},a.dispatchError=function(b,c,d){a.dispatchCustomEvent(a.customEvents.REQUESTR_ERROR,{type:b,message:c,details:d})},a.stopWindow=function(){window.stop?window.stop():document.execCommand("Stop")},a.parseSerialization=function(b){if(b&&(b.textContent||b.innerText)){try{b=JSON.parse(b.textContent||b.innerText)}catch(c){a.dispatchError(a.customErrors.SERIALIZATION,"Invalid JSON string in serialization block.")}a.serialization=b,b&&b.service?a.service=b.service:a.dispatchError(a.customErrors.SERIALIZATION,'An API end-point, "service", was not defined in the serialization block.'),b&&b.expires&&(a.cache.expires=new Date(b.expires).getTime()),window.dispatchEvent(new CustomEvent(a.customEvents.REQUESTR_READY)),b&&b.self?a.loadPage(window.location.href):b&&b.owner&&a.loadPage(b.owner)}else a.dispatchError(a.customErrors.SERIALIZATION,"A Requestr serialization block was not found when parsing the document.")},a.openLocalDb=function(b,c){var d,e;if(d=function(){"function"==typeof c&&c(!0)},e=function(){"function"==typeof c&&c(!1)},window.indexedDB){var f=window.indexedDB.open(a.CACHING_DB_NAME,b);f.onerror=function(b){a.dispatchError(a.customErrors.CACHING,"Could not initiate database used for caching. More error information found in details.",b.target),e()},f.onupgradeneeded=function(){if(!f.result.objectStoreNames.contains(a.CACHING_DB_STORE_NAME)){var b=f.result.createObjectStore(a.CACHING_DB_STORE_NAME,{keyPath:a.CACHING_DB_STORE_KEY});b.createIndex(a.CACHING_DB_STORE_KEY,a.CACHING_DB_STORE_KEY,{unique:!0})}},f.onsuccess=function(){a.localDb=f.result,d()}}else if(a.browser.isSafari)if(openDatabase){var g=a.localDbPolyfill=openDatabase(a.CACHING_DB_NAME,b,"Requestr WebSQL polyfill for IndexedDB",a.WEBSQL_DEFAULT_SIZE);g?g.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS "+a.CACHING_DB_STORE_NAME+"(url TEXT PRIMARY KEY, token TEXT, mimeType TEXT, "+"dataType TEXT, data TEXT, date INT)",[],function(){d()},function(){e()})}):e()}else e();else a.dispatchError(a.customErrors.CACHING,"User's browser does not support custom caching capabilities required by Requestr."),e()},a.closeLocalDb=function(){a.localDb&&a.localDb.close&&(a.localDb.close(),a.localDb=null)},a.cache.update=function(b){var c,d;c=function(){},d=function(b){a.dispatchError(a.customErrors.CACHING,"An error occured copying resource(s) to the cache.More error information found in details.",b)},window.indexedDB?a.openLocalDb(a.CACHING_DB_VERSION,function(e){e&&a.cache.add(b,c,d)}):a.browser.isSafari&&a.localDbPolyfill&&a.cache.pollyfill.websql.add(b,c,d)},a.cache.pollyfill.websql.add=function(b,c,d){var e,f,g,h=0,i=0;e=function(){i===h&&"function"==typeof c&&c()},f=function(){i++,e()},g=function(b){a.localDbPolyfill.transaction(function(c){c.executeSql("UPDATE "+a.CACHING_DB_STORE_NAME+" SET url=?, token=?, mimeType=?, dataType=?, data=?, "+'date=? WHERE url = "'+b.url+'"',[b.url,b.token,b.mimeType,b.dataType,b.data,b.date],f,function(a){d(a)})})},a.localDbPolyfill.transaction(function(c){var d,e;for(d in b)e=b[d],h++,c.executeSql("INSERT INTO "+a.CACHING_DB_STORE_NAME+"(url, token, mimeType, dataType, data, date) "+"VALUES (?,?,?,?,?,?)",[e.url,e.token,e.mimeType,e.dataType,e.data,e.date],f,g.call(this,e))})},a.cache.add=function(b,c,d){var e,f,g,h,i,j=a.localDb.transaction([a.CACHING_DB_STORE_NAME],"readwrite");e=j.objectStore(a.CACHING_DB_STORE_NAME),j.oncomplete=function(b){"function"==typeof c&&c(b),a.closeLocalDb()},j.onerror=function(b){"function"==typeof d&&d(b),a.closeLocalDb()},h=function(a){delete b[a.target.result]},i=function(b){a.dispatchError(a.customErrors.CACHING,"An error occured copying resource(s) to the cache.More error information found in details.",b.target.error)};for(f in b)if(g=b[f],g.url){var k=e.put(g);k.onsuccess=h,k.onerror=i}},a.cache.pollyfill.websql.read=function(b,c){var d,e,f,g,h,i=b.length,j=0,k=[];f=function(){j===i&&(a.resourcesFetchedFromCache=a.resourcesFetchedFromCache.concat(k),"function"==typeof c&&c(k))},g=function(a,b){j++,b.rows.length&&k.push(b.rows.item(0)),f()},h=function(){j++,f()},a.localDbPolyfill.transaction(function(c){for(d=0;e=b[d]?b[d].Url:null;d++)e&&c.executeSql("SELECT * FROM "+a.CACHING_DB_STORE_NAME+" WHERE url=?",[e],g,h)})},a.cache.read=function(b,c){var d,e,f,g,h,i,j,k,l,m=[];j=function(){f===e&&(a.resourcesFetchedFromCache=a.resourcesFetchedFromCache.concat(m),"function"==typeof c&&c(m),a.closeLocalDb())},k=function(a){f++,m.push(a.target.result),j()},l=function(){f++,j()},window.indexedDB?a.openLocalDb(a.CACHING_DB_VERSION,function(j){if(j&&a.localDb&&a.localDb.objectStoreNames.length){for(i=a.localDb.transaction([a.CACHING_DB_STORE_NAME]),d=i.objectStore(a.CACHING_DB_STORE_NAME),g=0,f=0,e=b.length;h=b[g]?b[g].Url:null;g++)if(h){var m=d.get(h);m.onsuccess=k,m.onerror=l}}else c([])}):a.browser.isSafari&&a.localDbPolyfill?a.cache.pollyfill.websql.read(b,c):c([])},a.cache.remove=function(){console.log("Error: Removing resources from Requestr cache not currently supported.")},a.cache.clear=function(){window.indexedDB?a.openLocalDb(a.CACHING_DB_VERSION,function(b){b&&window.indexedDB.deleteDatabase(a.CACHING_DB_NAME),a.closeLocalDb()}):a.browser.isSafari&&a.localDbPolyfill&&a.localDbPolyfill.transaction(function(b){b.executeSql("DROP TABLE "+a.CACHING_DB_STORE_NAME)})},a.loadFragment=function(b,c,d){var e,f=window.document.implementation.createHTMLDocument("");e=f.createElement("base"),e.setAttribute("href",b),f.head.appendChild(e),f.body.innerHTML=c,a.parsePage({originUrl:b,target:{response:f}},function(a){a.html?(f=window.document.implementation.createHTMLDocument(""),f.documentElement.innerHTML=a.html,"function"==typeof d&&d(f.body.innerHTML),f=null):"function"==typeof d&&d(null)},null,null,!0)},a.loadPage=function(b,c,d,e){d=d||a.cache.expires,document.documentElement.classList.add(a.LOADING_CLASS),"function"!=typeof c&&a.stopWindow(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_START);var f=document.createElement("a");f.setAttribute("href",b),f=f.href,a.service?a.requestDataUriFromService(a.service,[{Url:f,Document:!0,Token:null,Type:"STRING"}],{load:function(b){var g,h=b.target.response;if("object"!=typeof h&&(h=JSON.parse(h)),h&&(h=h.Resources)&&(h=h[0])){h.Data?a.resourcesToCache[h.Url]={url:h.Url,mimeType:h.ContentType,dataType:h.Type,token:h.Token,date:Date.now(),data:h.Data}:h&&(g=a.xhr.cachedDocument)?(h.Data=g.data,h.Type=g.dataType):h.Data="";var i,j,k=new DOMParser,l=window.document.implementation.createHTMLDocument("");h.ContentType.indexOf(";")&&(h.ContentType="text/html"),j=k.parseFromString(h.Data,h.ContentType),j||(j=window.document.implementation.createHTMLDocument(""),j.documentElement.innerHTML=h.Data,console.log("Warning: This browser does not support DOMParser fully, documentElement will not inherit original attributes.")),0===(i=j.getElementsByTagName("base")).length&&(i=j.createElement("base"),i.setAttribute("href",f),j.head.insertBefore(i,j.head.firstChild)),l.documentElement.innerHTML=j.documentElement.outerHTML,a.duplicateElementAttributes(j.documentElement,l.documentElement),a.parsePage({originUrl:f,target:{response:l}},c,d,e)}else a.dispatchError(a.customErrors.SERVICE,"Service API did not return a document."),c(null)},error:c||a.pageLoadError,progress:null,abort:c||a.pageLoadAbort},null,d,2e6):a.dispatchError(a.customErrors.SERVICE,"Unable to load document due to no service API specified.")},a.pageLoadProgress=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_PROGRESS,{progress:Math.round(100*(b.loaded/b.totalSize)),bytes:b.loaded,total:b.totalSize})},a.pageLoadError=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.pageLoadAbort=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.parsePage=function(b,c,d,e,f){var g;if(a.service){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_COMPLETE),d=d||(a.xhr?a.xhr.documentExpires:null),g=a.ownerDocument=b.target.response,a.browser.ieInternetExplorer&&(g.ieURL=b.originUrl),e&&(e.head&&(e.head.before&&(g.head.innerHTML=e.head.before+g.head.innerHTML),e.head.after&&(g.head.innerHTML=g.head.innerHTML+e.head.after)),e.body&&(e.body.before&&(g.body.innerHTML=e.body.before+g.body.innerHTML),e.body.after&&(g.body.innerHTML=g.body.innerHTML+e.body.after)));var h,i,j,k,l,m,n,o,p,q,r=[],s=g.querySelectorAll(a.ELEMENTS_QUERY),t=a.browser.ieInternetExplorer?g.ieURL:g.URL;for(h=0,j=s.length;l=s[h];h++)a.urlParsingEnabledElement[l.nodeName]&&(1===l.nodeType&&"LINK"===l.nodeName&&/(?:^| )stylesheet(?:\/less)?(?:$| )/i.test(l.rel)&&l.href?r.push({Url:l.href,Token:null,Type:"STRING"}):r.push({Url:l.src||l.href,Token:null}),l.src?l.setAttribute("src",l.src):l.href&&l.setAttribute("href",l.href));for(0===(m=g.getElementsByTagName("base")).length&&(m=g.createElement("base"),m.setAttribute("href",t),g.head.insertBefore(m,g.head.firstChild)),(n=g.querySelector(a.SERIALIZATION_QUERY))&&n.parentNode.removeChild(n),(n=g.querySelector("["+a.JS_ELEMENT_ATTRIBUTE+"]"))&&n.parentNode.removeChild(n),s=g.getElementsByTagName("style"),h=0,j=s.length;l=s[h];h++)if(!l.sheet||a.browser.isFirefox||a.browser.ieInternetExplorer?(l.innerText?o=l.innerText:l.textContent&&(o=l.textContent),q={Url:t,Data:o},p=a.parseCssResourcesForUrls([q]),l.innerText?l.innerText=q.Data:l.textContent&&(l.textContent=q.Data)):(o=a.getParsedCssFromRules(l.sheet.rules),l.innerText?l.innerText=o:l.textContent&&(l.textContent=o),p=a.getUrlsFromCssString(o)),p)for(i=0,k=p.length;k>i;i++)r.push({Url:p[i],Token:null});a.documentString=g.documentElement.outerHTML,a.xhr&&a.xhr.blobUrlCallback&&(c=a.xhr.blobUrlCallback),a.requestDataUriFromService(a.service,r,{load:a.handleResponseResources,error:a.handleResponseResourcesError,progress:a.handleResponseResourcesProgress,abort:a.handleResponseResourcesAbort,fragment:f},c,d),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_START)}else a.dispatchError(a.customErrors.SERVICE,"Unable to load requested data due to no service API specified.")},a.getMatchingObjectWithUrl=function(a,b){return a.filter(function(a){return a?a.url===b:null})[0]},a.requestDataUriFromService=function(b,c,d,e,f,g){a.cache.read(c,function(h){var i,j,k,l,m,n,o,p,q,r=[];q=a.xhr=new XMLHttpRequest,q.open("POST",b,!0),q.setRequestHeader("Content-type","application/json"),q.setRequestHeader("Accept","application/json"),e&&(q.blobUrlCallback=e),f&&(q.documentExpires=f);try{q.responseType="json"}catch(s){}for(d&&("function"==typeof d.load&&q.addEventListener("load",d.load,!0),"function"==typeof d.error&&q.addEventListener("error",d.error,!0),"function"==typeof d.progress&&q.addEventListener("progress",d.progress,!0),"function"==typeof d.abort&&q.addEventListener("abort",d.abort,!0),d.fragment&&(q.blobUrlFragment=!0)),a.serialization&&(Array.isArray(a.serialization.allow)&&(m=a.serialization.allow),Array.isArray(a.serialization.exclude)&&(l=a.serialization.exclude)),i=0;o=c[i];i++){if(m){for(j=0,n=m.length;n>j;j++)0===o.Url.indexOf(m[j])&&(p=!0,j=n);p||o.Document||(o.Url="")}if(l)for(j=0,n=l.length;n>j;j++)0===o.Url.indexOf(l[j])&&(o.Document||(o.Url=""),j=n);""!==o.Url&&(k=a.getMatchingObjectWithUrl(h,o.Url),k&&(k.date<f&&(o.Url=""),o.Token=k.token,o.Document&&(q.cachedDocument=k))),o.Document&&delete o.Document}for(i=0;o=c[i];i++)""!==o.Url&&r.push(o);if(r.length)q.send(JSON.stringify({MaxSize:g||(a.serialization?a.serialization.maxFileSize:null)||a.DEFAULT_SERVICE_FILE_MAX_SIZE,Urls:r}));else{for(r=[],i=0,n=h.length;n>i;i++)(o=h[i])&&r.push({Url:o.url,Type:o.dataType,Data:o.data,ContentType:o.mimeType});"function"==typeof d.load&&d.load({target:{response:{Resources:r}}}),h=r=null}})},a.getParsedCssFromRules=function(a){if(a){var b,c=a.length,d="";for(b=0;c>b;b++)d+=a[b].cssText;return d}return null},a.getUrlsFromCssString=function(b){var c=b.match(/url\(()(.+?)\1\)/gi);return c=Array.isArray(c)?c.toString().match(a.matchUrlPattern):null},a.removeResponseLoadXhrListener=function(){a.xhr&&(a.xhr.removeEventListener("load",a.handleResponseResources,!0),a.xhr.removeEventListener("error",a.handleResponseResourcesError,!0),a.xhr.removeEventListener("progress",a.handleResponseResourcesProgress,!0),a.xhr.removeEventListener("abort",a.handleResponseResourcesAbort,!0))},a.handleResponseResources=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_COMPLETE),a.removeResponseLoadXhrListener(),b="object"!=typeof b.target.response?JSON.parse(b.target.response):b.target.response;var c,d,e,f,g,h=b,i=a.documentString,j=[],k=h.Resources,l=window.document.implementation.createHTMLDocument(""),m=a.xhr.blobUrlCallback,n=a.xhr.blobUrlFragment,o=a.xhr.documentExpires;if(h.Resources||a.dispatchCustomEvent(a.customEvents.RESOURCE_API_ERROR),l.documentElement.innerHTML=i,a.dispatchCustomEvent(a.customEvents.RESOURCE_RESOLVING),c=l.getElementsByTagName("style"),k){for(d=0;g=k[d];d++)g.Type||(f=a.getMatchingObjectWithUrl(a.resourcesFetchedFromCache,g.Url),f?(g.Type=f.dataType,g.Data=f.data,g.ContentType=f.mimeType):a.dispatchError(a.customErrors.CACHING,"Unable to resolve resource from cache, resource will not be loaded via Requestr, it will make network request.")),"text/css"===g.ContentType&&"STRING"===g.Type?j.push(g):a.replaceDocumentUrlsWithBlob(g,l,c);e=a.parseCssResourcesForUrls(j)}j.length>0&&e&&e.length>0?a.loadExternalCssUrls(e,j,o,l,c,function(){a.completeResolvingDocument(l,a.ownerDocument,m,n)}):j.length>0?a.loadExternalCssUrls([],j,o,l,c,function(){a.completeResolvingDocument(l,a.ownerDocument,m,n)}):a.completeResolvingDocument(l,a.ownerDocument,m,n),a.xhr=null},a.handleResponseResourcesProgress=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleResponseResourcesAbort=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b})},a.handleResponseResourcesError=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b}),a.setDocumentHtml(a.ownerDocument,a.documentString)},a.completeResolvingDocument=function(b,c,d,e){d&&"function"==typeof d?(a.createDocumentBlobUrl(b,c,d,e),document.documentElement.classList.remove(a.LOADING_CLASS)):a.setDocumentHtml(c,b.documentElement.outerHTML),a.cache.update(a.resourcesToCache)},a.loadExternalCssUrls=function(b,c,d,e,f,g){var h,i,j=b.length,k=[];for(h=0;j>h;h++)i=b[h],a.resolvedUrls[i]||k.push({Url:i,Token:null});0===k.length?a.resolveDocumentCssUrls(c,e,f,g):(a.requestDataUriFromService(a.service,k,{progress:a.handleExternalCssResourcesProgress,load:function(b){a.handleDocumentCssUris(b,c,e,f,g)},error:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,e,f,g)},abort:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,e,f,g)}},null,d),a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_START))},a.handleExternalCssResourcesProgress=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleExternalCssResourcesError=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_ERROR,{error:b})},a.handleDocumentCssUris=function(b,c,d,e,f){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_COMPLETE);var g,h,i,j,k;if(k="object"!=typeof b.target.response?JSON.parse(b.target.response).Resources:b.target.response.Resources){for(g=0;h=k[g];g++)"text/css"===h.ContentType&&"STRING"===h.Type?j.push(h):a.createUrlFromResource(h);i=a.parseCssResourcesForUrls(j)}i?console.log("Error: CSS imports not currently supported!"):a.resolveDocumentCssUrls(c,d,e,f)},a.resolveDocumentCssUrls=function(b,c,d,e){var f,g,h,i=a.resolvedUrls;for(g=0;h=b[g];g++){for(f in i)h.origData=h.origData?h.origData:h.Data,h.Data=h.Data.replace(new RegExp(a.thirdParty.preg_quote(f),"gi"),i[f]);a.replaceDocumentUrlsWithBlob(h,c,d)}"function"==typeof e&&e()},a.parseCssResourcesForUrls=function(b){var c,d,e,f,g,h,i,j,k=[],l=Array.isArray(b)?b.length:0;if(i=function(a){return e.setAttribute("href",a.match(/\((.*?)\)/)[1]),"url("+e.href+")"},l>0){for(g=0;l>g;g++)j=b[g],f=window.document.implementation.createHTMLDocument(""),d=f.createElement("base"),c=f.createElement("style"),d.setAttribute("href",j.Url),c.innerHTML=j.Data,f.head.appendChild(d),f.head.appendChild(c),!c.sheet||a.browser.isFirefox||a.browser.ieInternetExplorer?(e=f.createElement("a"),f.body.appendChild(e),j.Data=j.Data.replace(/\burl\((\'|\"|)([^\'\"]+?)\1\)/g,i),h=a.getUrlsFromCssString(j.Data)):h=a.getUrlsFromCssString(j.Data=a.getParsedCssFromRules(c.sheet.cssRules)),h&&(k=k.concat(h)),f=d=c=null;return k}},a.matchResourceWithCache=function(b,c){var d=!1,e=a.getMatchingObjectWithUrl(b,c.Url);return e&&(c.Type=e.dataType,c.Data=e.data,c.ContentType=e.mimeType,d=!0),d},a.createUrlFromResource=function(b){b.Data||a.matchResourceWithCache(a.resourcesFetchedFromCache,b)||a.dispatchError(a.customErrors.CACHING,"Unable to resolve resource from cache.");var c="STRING"===b.Type?a.dataStringToBlob(b.Data,b.ContentType):a.dataURItoBlob(b.Data,b.ContentType);return a.resourcesToCache[b.Url]={url:b.Url,mimeType:b.ContentType,dataType:b.Type,token:b.Token,date:Date.now(),data:b.origData||b.Data},(a.resolvedUrls[b.Url]=window.URL.createObjectURL(c))||b.Url},a.replaceDocumentUrlsWithBlob=function(b,c,d){var e,f,g,h,i,j=a.createUrlFromResource(b),k=a.serialization?a.serialization.development:!1;for(h=c.querySelectorAll('[src="'+b.Url+'"], [href="'+b.Url+'"]'),e=0;g=h[e];e++)g.src&&(k&&g.setAttribute(a.ORIGINAL_URL_ATTRIBUTE,g.src),g.setAttribute("src",j)),g.href&&(k&&g.setAttribute(a.ORIGINAL_URL_ATTRIBUTE,g.href),g.setAttribute("href",j));for(f=0;i=d[f];f++)i.innerText?i.innerText=i.innerText.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j):i.textContent&&(i.textContent=i.textContent.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j))},a.dataURItoBlob=function(a,b){var c,d=[],e=atob(a.split(",")[1]),f=e.length;for(c=0;f>c;c++)d.push(e.charCodeAt(c));return new Blob([new Uint8Array(d)],{type:b?b:"text/plain"})},a.dataStringToBlob=function(b,c){return a.dataURItoBlob("data:"+c+";base64,"+btoa(unescape(encodeURIComponent(b))),c)},a.setDocumentHtml=function(b,c){var d,e,f,g=window.document.implementation.createHTMLDocument("");for(g.documentElement.innerHTML=c,a.setDocumentElementAttributes(document.documentElement,b.documentElement),document.documentElement.innerHTML=c,e=document.querySelectorAll("script"),d=0;f=e[d];d++){var h=document.createElement("script");a.duplicateElementAttributes(f,h),h.textContent=f.textContent||f.innerText,f.parentNode.insertBefore(h,f),f.parentNode.removeChild(f)}document.documentElement.classList.remove(a.LOADING_CLASS),window.dispatchEvent(new CustomEvent("load")),a.dispatchCustomEvent(a.customEvents.DOCUMENT_RENDERED,{document:c})},a.createDocumentBlobUrl=function(b,c,d,e){a.setDocumentElementAttributes(b.documentElement,c.documentElement);var f;e||(f=window.URL.createObjectURL(a.dataStringToBlob(b.documentElement.outerHTML,"text/html"))),"function"==typeof d&&(d({url:f,html:b.documentElement.outerHTML}),e||a.dispatchCustomEvent(a.customEvents.DOCUMENT_BLOB_URL_CREATED,{url:f,html:b.documentElement.outerHTML}))},a.duplicateElementAttributes=function(a,b){var c,d,e,f=a.attributes;for(c=0,d=f.length;d>c;c++)e=f[c],b.setAttribute(e.name,e.value)},a.setDocumentElementAttributes=function(b,c){var d,e,f,g;for(d=b.attributes,e=0,f=d.length;f>e;e++)g=d[e],g&&b.removeAttribute(g.name);a.duplicateElementAttributes(c,b),d=g=e=f=null},a.thirdParty.preg_quote=function(a){return(a+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")},a.init=function(b){b?a.parseSerialization(b):window.addEventListener("DOMContentLoaded",function(){a.parseSerialization(a.serialization=document.querySelector(a.SERIALIZATION_QUERY))})},a.serialization||window.addEventListener("DOMContentLoaded",function(){a.serialization=document.querySelector(a.SERIALIZATION_QUERY)}),!window.indexedDB&&a.browser.isSafari?a.openLocalDb(a.CACHING_DB_VERSION,function(b){a.init(a.serialization)}):a.init(a.serialization)}()));
      </script>    
      <script type="text/requestr-serialization">
        {
          "service": "http://localhost:8868/tradeshift-app-service/rest/app/resolveresources",
          "maxFileSize": 200000,
          "expires": "Mon, 10 Mar 2014 20:00:00 GMT"
        }
      </script>
      <style type="text/css">
        * {
          margin: 0;
          padding: 0;
        }
        html, body {
          width: 100%;
          height: 100%;
        }
        iframe#app {
          border: 0px;
          margin: 0px;
          padding: 0px;
          top: 0px;
          left: 0px;
          width: 100%;
          height: 100%;
          float: left;
        }
      </style>
    </head>
    <body>
      <iframe id="app"></iframe>
    </body>
</html>
