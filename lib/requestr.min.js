"undefined"!=typeof window&&(window.Requestr||(!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}window.CustomEvent&&(a.prototype=window.CustomEvent.prototype),window.CustomEvent=a}(),function(){"use strict";window.URL=window.URL||window.webkitURL,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,window.indexedDB||(window.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB);var a=window.Requestr={};a.LOADING_CLASS="requestr",a.ELEMENTS_QUERY='[rel~="stylesheet"][href], [rel~="icon"][href], [src]',a.SERIALIZATION_QUERY='script[type="text/requestr-serialization"]',a.JS_ELEMENT_ATTRIBUTE="data-requestr-js",a.DEFAULT_SERVICE_FILE_MAX_SIZE=4e4,a.serialization=document.querySelector(a.SERIALIZATION_QUERY),a.onEvent=null,a.urlParsingEnabledElement={IMG:!0,LINK:!0,SCRIPT:!0},a.resolvedUrls=[],a.thirdParty={},a.browser={userAgent:navigator.userAgent.toLowerCase()},a.browser.isSafari=a.browser.userAgent.indexOf("safari")>-1,a.browser.isFirefox=a.browser.userAgent.indexOf("firefox")>-1,a.browser.ieInternetExplorer=a.browser.userAgent.indexOf("msie")>-1,a.customEvents={REQUESTR_READY:"requestrReady",DOCUMENT_LOAD_START:"documentLoadStart",DOCUMENT_LOAD_PROGRESS:"documentLoadProgress",DOCUMENT_LOAD_ERROR:"documentLoadError",DOCUMENT_LOAD_COMPLETE:"documentLoadComplete",DOCUMENT_RENDERED:"documentRendered",DOCUMENT_BLOB_URL_CREATED:"documentBlobUrlCreated",RESOURCE_API_ERROR:"resourceApiError",RESOURCE_LOAD_START:"resourceLoadStart",RESOURCE_LOAD_PROGRESS:"resourceLoadProgress",RESOURCE_LOAD_ERROR:"resourceLoadError",RESOURCE_LOAD_COMPLETE:"resourceLoadComplete",RESOURCE_RESOLVING:"resourceResolving",EXTERNAL_CSS_LOAD_START:"externalCssLoadStart",EXTERNAL_CSS_LOAD_COMPLETE:"externalCssLoadComplete",EXTERNAL_CSS_LOAD_PROGRESS:"externalCssLoadProgress",EXTERNAL_CSS_LOAD_ERROR:"externalCssLoadError"},a.CACHING_DB_NAME="Requestr",a.CACHING_DB_STORE_NAME="datauris",a.CACHING_DB_STORE_KEY="url",a.CACHING_DB_VERSION=1,a.localDb=null,a.localDbPolyfill=null,a.resourcesToCache=[],a.resourcesFetchedFromCache=[],a.cache={pollyfill:{websql:{}}},a.WEBSQL_DEFAULT_SIZE=2621440,a.dispatchCustomEvent=function(b,c){"function"==typeof a.onEvent&&a.onEvent(c?new CustomEvent(b,{detail:c}):new CustomEvent(b))},a.stopWindow=function(){window.stop?window.stop():document.execCommand("Stop")},a.parseSerialization=function(b){b&&(b.textContent||b.innerText)&&(b=JSON.parse(b.textContent||b.innerText),a.serialization=b,b&&b.service&&(a.service=b.service),window.dispatchEvent(new CustomEvent(a.customEvents.REQUESTR_READY)),b&&b.self?a.loadPage(window.location.href):b&&b.owner&&a.loadPage(b.owner))},a.initLocalDb=function(b,c){var d,e;if(d=function(){"function"==typeof c&&c(!0)},e=function(){"function"==typeof c&&c(!1)},window.indexedDB){var f=window.indexedDB.open(a.CACHING_DB_NAME,b);f.onerror=function(a){console.log("Error: Could not initiate database used by Requestr for caching. (Code: "+a.target.errorCode+")"),e()},f.onupgradeneeded=function(){if(!f.result.objectStoreNames.contains(a.CACHING_DB_STORE_NAME)){var b=f.result.createObjectStore(a.CACHING_DB_STORE_NAME,{keyPath:a.CACHING_DB_STORE_KEY});b.createIndex(a.CACHING_DB_STORE_KEY,a.CACHING_DB_STORE_KEY,{unique:!0})}},f.onsuccess=function(){a.localDb=f.result,d()}}else if(a.browser.isSafari)if(openDatabase){var g=a.localDbPolyfill=openDatabase(a.CACHING_DB_NAME,b,"Requestr WebSQL polyfill for IndexedDB",a.WEBSQL_DEFAULT_SIZE);g?g.transaction(function(b){b.executeSql("CREATE TABLE IF NOT EXISTS "+a.CACHING_DB_STORE_NAME+"(url TEXT PRIMARY KEY, token TEXT, mimeType TEXT, dataType TEXT, data TEXT)",[],function(){d()},function(){e()})}):e()}else e();else console.log("Warning: Your browser does not support the caching capabilities required by Requestr."),e()},a.cache.update=function(b){var c,d;c=function(){},d=function(a){console.log("Error: An error copying resource(s) to Requestr cache."),console.dir(a)},a.localDb?a.cache.add(b,c,d):a.browser.isSafari&&a.localDbPolyfill&&a.cache.pollyfill.websql.add(b,c,d)},a.cache.pollyfill.websql.add=function(b,c,d){var e,f,g,h=0,i=0;e=function(){i===h&&"function"==typeof c&&c()},f=function(){i++,e()},g=function(b){a.localDbPolyfill.transaction(function(c){c.executeSql("UPDATE "+a.CACHING_DB_STORE_NAME+' SET url=?, token=?, mimeType=?, dataType=?, data=? WHERE url = "'+b.url+'"',[b.url,b.token,b.mimeType,b.dataType,b.data],f,function(a){d(a)})})},a.localDbPolyfill.transaction(function(c){var d,e;for(d in b)e=b[d],h++,c.executeSql("INSERT INTO "+a.CACHING_DB_STORE_NAME+"(url, token, mimeType, dataType, data) VALUES (?,?,?,?,?)",[e.url,e.token,e.mimeType,e.dataType,e.data],f,g.call(this,e))})},a.cache.add=function(b,c,d){var e,f,g,h,i,j=a.localDb.transaction([a.CACHING_DB_STORE_NAME],"readwrite");e=j.objectStore(a.CACHING_DB_STORE_NAME),j.oncomplete=function(a){"function"==typeof c&&c(a)},j.onerror=function(a){"function"==typeof d&&d(a)},h=function(a){delete b[a.target.result]},i=function(a){console.log("Error: An error copying resource to Requestr cache. "+a.target.error.message)};for(f in b)if(g=b[f],g.url){var k=e.put(g);k.onsuccess=h,k.onerror=i}},a.cache.pollyfill.websql.read=function(b,c){var d,e,f,g,h,i=b.length,j=0,k=[];f=function(){j===i&&(a.resourcesFetchedFromCache=a.resourcesFetchedFromCache.concat(k),"function"==typeof c&&c(k))},g=function(a,b){j++,b.rows.length&&k.push(b.rows.item(0)),f()},h=function(){j++,f()},a.localDbPolyfill.transaction(function(c){for(d=0;e=b[d]?b[d].Url:null;d++)e&&c.executeSql("SELECT * FROM "+a.CACHING_DB_STORE_NAME+" WHERE url=?",[e],g,h)})},a.cache.read=function(b,c){var d,e,f,g,h,i,j,k,l,m=[];if(j=function(){f===e&&(a.resourcesFetchedFromCache=a.resourcesFetchedFromCache.concat(m),"function"==typeof c&&c(m))},k=function(a){f++,m.push(a.target.result),j()},l=function(){f++,j()},a.localDb){for(i=a.localDb.transaction([a.CACHING_DB_STORE_NAME]),d=i.objectStore(a.CACHING_DB_STORE_NAME),g=0,f=0,e=b.length;h=b[g]?b[g].Url:null;g++)if(h){var n=d.get(h);n.onsuccess=k,n.onerror=l}}else a.browser.isSafari&&a.localDbPolyfill?a.cache.pollyfill.websql.read(b,c):c([])},a.cache.remove=function(){console.log("Error: Removing resources from Requestr cache not currently supported.")},a.cache.clear=function(){a.localDb?window.indexedDB.deleteDatabase(a.CACHING_DB_NAME):a.browser.isSafari&&a.localDbPolyfill&&a.localDbPolyfill.transaction(function(b){b.executeSql("DROP TABLE "+a.CACHING_DB_STORE_NAME)})},a.loadPage=function(b,c,d){document.documentElement.classList.add(a.LOADING_CLASS),"function"!=typeof c&&a.stopWindow(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_START);var e=document.createElement("a");e.setAttribute("href",b),e=e.href,0===e.indexOf(window.location.origin)?(a.xhr=new XMLHttpRequest,a.xhr.open("GET",b,!0),c&&(a.xhr.blobUrlCallback=c),d&&(a.xhr.documentMutator=d),a.browser.ieInternetExplorer&&(a.xhr.originUrl=b),a.xhr.addEventListener("load",a.parsePage,!0),a.xhr.addEventListener("progress",a.pageLoadProgress,!0),a.xhr.addEventListener("error",a.pageLoadError,!0),a.xhr.addEventListener("abort",a.pageLoadAbort,!0),a.xhr.responseType="document",a.xhr.send()):a.service?a.requestDataUriFromService(a.service,[{Url:e,Token:null,Type:"STRING"}],{load:function(b){var f=b.target.response;if("object"!=typeof f&&(f=JSON.parse(f)),f&&(f=f.Resources)&&(f=f[0])){var g,h,i=new DOMParser,j=window.document.implementation.createHTMLDocument("");h=i.parseFromString(f.Data,"text/html"),h||(h=window.document.implementation.createHTMLDocument(""),h.documentElement.innerHTML=f.Data,console.log("Warning: This browser does not support DOMParser fully, documentElement will not inherit original attributes.")),0===(g=h.getElementsByTagName("base")).length&&(g=h.createElement("base"),g.setAttribute("href",e),h.head.insertBefore(g,h.head.firstChild)),j.documentElement.innerHTML=h.documentElement.outerHTML,a.duplicateElementAttributes(h.documentElement,j.documentElement),a.parsePage({originUrl:e,target:{response:j}},c,d)}else console.log("Error: Service API did not return a document!"),c(null)},error:c,progress:null,abort:c},null,2e6):console.log("Error: Cannot load page. Page is not relative and no service API was specified.")},a.removePageLoadXhrListeners=function(){a.xhr&&(a.xhr.removeEventListener("load",a.parsePage,!0),a.xhr.removeEventListener("progress",a.pageLoadProgress,!0),a.xhr.removeEventListener("error",a.pageLoadError,!0),a.xhr.removeEventListener("abort",a.pageLoadAbort,!0))},a.pageLoadProgress=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_PROGRESS,{progress:Math.round(100*(b.loaded/b.totalSize)),bytes:b.loaded,total:b.totalSize})},a.pageLoadError=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.pageLoadAbort=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.parsePage=function(b,c,d){if(a.service){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_COMPLETE),a.removePageLoadXhrListeners(),a.ownerDocument=b.target.response,a.browser.ieInternetExplorer&&(a.ownerDocument.ieURL=b.originUrl),(d||(d=a.xhr.documentMutator))&&(d.head&&(d.head.before&&(a.ownerDocument.head.innerHTML=d.head.before+a.ownerDocument.head.innerHTML),d.head.after&&(a.ownerDocument.head.innerHTML=a.ownerDocument.head.innerHTML+d.head.after)),d.body&&(d.body.before&&(a.ownerDocument.body.innerHTML=d.body.before+a.ownerDocument.body.innerHTML),d.body.after&&(a.ownerDocument.body.innerHTML=a.ownerDocument.body.innerHTML+d.body.after)));var e,f,g,h,i,j,k,l,m,n,o=[],p=a.ownerDocument.querySelectorAll(a.ELEMENTS_QUERY),q=a.browser.ieInternetExplorer?a.ownerDocument.ieURL:a.ownerDocument.URL;for(e=0,g=p.length;i=p[e];e++)a.urlParsingEnabledElement[i.nodeName]&&(1===i.nodeType&&"LINK"===i.nodeName&&i.href?o.push({Url:i.href,Token:null,Type:"STRING"}):o.push({Url:i.src||i.href,Token:null}),i.src?i.setAttribute("src",i.src):i.href&&i.setAttribute("href",i.href));for(0===(j=a.ownerDocument.getElementsByTagName("base")).length&&(j=a.ownerDocument.createElement("base"),j.setAttribute("href",q),a.ownerDocument.head.insertBefore(j,a.ownerDocument.head.firstChild)),(k=a.ownerDocument.querySelector(a.SERIALIZATION_QUERY))&&k.parentNode.removeChild(k),(k=a.ownerDocument.querySelector("["+a.JS_ELEMENT_ATTRIBUTE+"]"))&&k.parentNode.removeChild(k),p=a.ownerDocument.getElementsByTagName("style"),e=0,g=p.length;i=p[e];e++)if(!i.sheet||a.browser.isFirefox||a.browser.ieInternetExplorer?(i.innerText?l=i.innerText:i.textContent&&(l=i.textContent),n={Url:q,Data:l},m=a.parseCssResourcesForUrls([n]),i.innerText?i.innerText=n.Data:i.textContent&&(i.textContent=n.Data)):(l=a.getParseCssFromRules(i.sheet.rules),i.innerText?i.innerText=l:i.textContent&&(i.textContent=l),m=a.getUrlsFromCssString(l)),m)for(f=0,h=m.length;h>f;f++)o.push({Url:m[f],Token:null});a.documentString=a.ownerDocument.documentElement.outerHTML,a.xhr&&a.xhr.blobUrlCallback&&(c=a.xhr.blobUrlCallback),a.requestDataUriFromService(a.service,o,{load:a.handleResponseResources,error:a.handleResponseResourcesError,progress:a.handleResponseResourcesProgress,abort:a.handleResponseResourcesAbort},c),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_START)}},a.getMatchingObjectWithUrl=function(a,b){return a.filter(function(a){return a?a.url===b:null})[0]},a.requestDataUriFromService=function(b,c,d,e,f){a.cache.read(c,function(g){var h,i,j,k,l,m,n;a.xhr=new XMLHttpRequest,a.xhr.open("POST",b,!0),a.xhr.setRequestHeader("Content-type","application/json"),a.xhr.setRequestHeader("Accept","application/json"),e&&(a.xhr.blobUrlCallback=e);try{a.xhr.responseType="json"}catch(o){}for(d&&("function"==typeof d.load&&a.xhr.addEventListener("load",d.load,!0),"function"==typeof d.error&&a.xhr.addEventListener("error",d.error,!0),"function"==typeof d.progress&&a.xhr.addEventListener("progress",d.progress,!0),"function"==typeof d.abort&&a.xhr.addEventListener("abort",d.abort,!0)),a.serialization&&(Array.isArray(a.serialization.allow)&&(l=a.serialization.allow),Array.isArray(a.serialization.exclude)&&(k=a.serialization.exclude)),h=0;n=c[h];h++){if(l)for(i=0,m=l.length;m>i;i++)0!==n.Url.indexOf(l[i])&&(n.Url="",i=m);if(k)for(i=0,m=k.length;m>i;i++)0===n.Url.indexOf(k[i])&&(n.Url="",i=m);j=a.getMatchingObjectWithUrl(g,n.Url),j&&(n.Token=j.token)}a.xhr.send(JSON.stringify({MaxSize:f||(a.serialization?a.serialization.maxFileSize:null)||a.DEFAULT_SERVICE_FILE_MAX_SIZE,Urls:c}))})},a.getParseCssFromRules=function(b){if(b){var c,d=b.length,e="";for(c=0;d>c;c++)e+=b[c].cssText;return a.getNormalizedCssString(e)}return null},a.getNormalizedCssString=function(a){return a.replace(/background\-position\: initial initial;/gi,"").replace(/background\-repeat\: initial initial;/gi,"")},a.getUrlsFromCssString=function(a){var b=a.match(/url\(()(.+?)\1\)/gi);return b=Array.isArray(b)?b.toString().match(/(\b(?:(?:https?|ftp|file|[A-Za-z]+):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$]))/gi):null},a.removeResponseLoadXhrListener=function(){a.xhr&&(a.xhr.removeEventListener("load",a.handleResponseResources,!0),a.xhr.removeEventListener("error",a.handleResponseResourcesError,!0),a.xhr.removeEventListener("progress",a.handleResponseResourcesProgress,!0),a.xhr.removeEventListener("abort",a.handleResponseResourcesAbort,!0))},a.handleResponseResources=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_COMPLETE),a.removeResponseLoadXhrListener(),b="object"!=typeof b.target.response?JSON.parse(b.target.response):b.target.response;var c,d,e,f,g,h=b,i=a.documentString,j=[],k=h.Resources,l=window.document.implementation.createHTMLDocument(""),m=a.xhr.blobUrlCallback;if(h.Resources||a.dispatchCustomEvent(a.customEvents.RESOURCE_API_ERROR),l.documentElement.innerHTML=i,a.dispatchCustomEvent(a.customEvents.RESOURCE_RESOLVING),c=l.getElementsByTagName("style"),k){for(d=0;g=k[d];d++)g.Type||(f=a.getMatchingObjectWithUrl(a.resourcesFetchedFromCache,g.Url),f?(g.Type=f.dataType,g.Data=f.data,g.ContentType=f.mimeType):console.log("Error: Could not find data in cache to resolve resource!")),"text/css"===g.ContentType&&"STRING"===g.Type?j.push(g):a.replaceDocumentUrlsWithBlob(g,l,c);e=a.parseCssResourcesForUrls(j)}j.length>0&&e&&e.length>0?a.loadExternalCssUrls(e,j,l,c,function(){a.completeResolvingDocument(l,a.ownerDocument,m)}):j.length>0?a.loadExternalCssUrls([],j,l,c,function(){a.completeResolvingDocument(l,a.ownerDocument,m)}):a.completeResolvingDocument(l,a.ownerDocument,m),a.xhr=null},a.completeResolvingDocument=function(b,c,d){d&&"function"==typeof d?(a.createDocumentBlobUrl(b,c,d),document.documentElement.classList.remove(a.LOADING_CLASS)):a.setDocumentHtml(c,b.documentElement.outerHTML),a.cache.update(a.resourcesToCache)},a.loadExternalCssUrls=function(b,c,d,e,f){var g,h,i=b.length,j=[];for(g=0;i>g;g++)h=b[g],a.resolvedUrls[h]||j.push({Url:h,Token:null});0===j.length?a.resolveDocumentCssUrls(c,d,e,f):(a.requestDataUriFromService(a.service,j,{progress:a.handleExternalCssProgress,load:function(b){a.handleDocumentCssUris(b,c,d,e,f)},error:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,d,e,f)},abort:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,d,e,f)}}),a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_START))},a.handleExternalCssProgress=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleExternalCssResourcesError=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_ERROR,{error:b})},a.handleDocumentCssUris=function(b,c,d,e,f){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_COMPLETE);var g,h,i,j,k;if(k="object"!=typeof b.target.response?JSON.parse(b.target.response).Resources:b.target.response.Resources){for(g=0;h=k[g];g++)"text/css"===h.ContentType&&"STRING"===h.Type?j.push(h):a.createUrlFromResource(h);i=a.parseCssResourcesForUrls(j)}i?console.log("Error: CSS imports not currently supported!"):a.resolveDocumentCssUrls(c,d,e,f)},a.resolveDocumentCssUrls=function(b,c,d,e){var f,g,h,i=a.resolvedUrls;for(g=0;h=b[g];g++){for(f in i)h.origData=h.origData?h.origData:h.Data,h.Data=h.Data.replace(new RegExp(a.thirdParty.preg_quote(f),"gi"),i[f]);a.replaceDocumentUrlsWithBlob(h,c,d)}"function"==typeof e&&e()},a.parseCssResourcesForUrls=function(b){var c,d,e,f,g,h,i,j,k=[],l=Array.isArray(b)?b.length:0;if(i=function(a){return e.setAttribute("href",a.match(/\((.*?)\)/)[1]),"url("+e.href+")"},l>0){for(g=0;l>g;g++)j=b[g],f=window.document.implementation.createHTMLDocument(""),d=f.createElement("base"),c=f.createElement("style"),d.setAttribute("href",j.Url),c.innerHTML=j.Data,f.head.appendChild(d),f.head.appendChild(c),!c.sheet||a.browser.isFirefox||a.browser.ieInternetExplorer?(e=f.createElement("a"),f.body.appendChild(e),j.Data=j.Data.replace(/\burl\((\'|\"|)([^\'\"]+?)\1\)/g,i),h=a.getUrlsFromCssString(j.Data)):h=a.getUrlsFromCssString(j.Data=a.getParseCssFromRules(c.sheet.cssRules)),h&&(k=k.concat(h)),f=d=c=null;return k}},a.matchResourceWithCache=function(b,c){var d=!1,e=a.getMatchingObjectWithUrl(b,c.Url);return e&&(c.Type=e.dataType,c.Data=e.data,c.ContentType=e.mimeType,d=!0),d},a.createUrlFromResource=function(b){b.Data||a.matchResourceWithCache(a.resourcesFetchedFromCache,b)||console.log("Error: Could not find data in cache to resolve resource!");var c="STRING"===b.Type?a.dataStringToBlob(b.Data,b.ContentType):a.dataURItoBlob(b.Data,b.ContentType);return a.resourcesToCache[b.Url]={url:b.Url,mimeType:b.ContentType,dataType:b.Type,token:b.Token,data:b.origData||b.Data},a.resolvedUrls[b.Url]=window.URL.createObjectURL(c)},a.replaceDocumentUrlsWithBlob=function(b,c,d){var e,f,g,h,i,j=a.createUrlFromResource(b);for(h=c.querySelectorAll('[src="'+b.Url+'"], [href="'+b.Url+'"]'),e=0;g=h[e];e++)g.src&&g.setAttribute("src",j),g.href&&g.setAttribute("href",j);for(f=0;i=d[f];f++)i.innerText?i.innerText=i.innerText.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j):i.textContent&&(i.textContent=i.textContent.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j))},a.handleResponseResourcesProgress=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleResponseResourcesAbort=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b})},a.handleResponseResourcesError=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b}),a.setDocumentHtml(a.ownerDocument,a.documentString)},a.dataURItoBlob=function(a,b){var c,d=[],e=atob(a.split(",")[1]),f=e.length;for(c=0;f>c;c++)d.push(e.charCodeAt(c));return new Blob([new Uint8Array(d)],{type:b?b:"text/plain"})},a.dataStringToBlob=function(b,c){return a.dataURItoBlob("data:"+c+";base64,"+btoa(unescape(encodeURIComponent(b))),c)},a.setDocumentHtml=function(b,c){var d,e,f,g=window.document.implementation.createHTMLDocument("");for(g.documentElement.innerHTML=c,a.setDocumentElementAttributes(document.documentElement,b.documentElement),document.documentElement.innerHTML=c,e=document.querySelectorAll("script"),d=0;f=e[d];d++){var h=document.createElement("script");a.duplicateElementAttributes(f,h),h.textContent=f.textContent||f.innerText,f.parentNode.insertBefore(h,f),f.parentNode.removeChild(f)}document.documentElement.classList.remove(a.LOADING_CLASS),window.dispatchEvent(new CustomEvent("load")),a.dispatchCustomEvent(a.customEvents.DOCUMENT_RENDERED,{document:c})},a.createDocumentBlobUrl=function(b,c,d){a.setDocumentElementAttributes(b.documentElement,c.documentElement);var e=window.URL.createObjectURL(a.dataStringToBlob(b.documentElement.outerHTML,"text/html"));"function"==typeof d&&(d({url:e,html:b.documentElement.outerHTML}),a.dispatchCustomEvent(a.customEvents.DOCUMENT_BLOB_URL_CREATED,{url:e,html:b.documentElement.outerHTML}))},a.duplicateElementAttributes=function(a,b){var c,d,e,f=a.attributes;for(c=0,d=f.length;d>c;c++)e=f[c],b.setAttribute(e.name,e.value)},a.setDocumentElementAttributes=function(b,c){var d,e,f,g;for(d=b.attributes,e=0,f=d.length;f>e;e++)g=d[e],g&&b.removeAttribute(g.name);a.duplicateElementAttributes(c,b),d=g=e=f=null},a.thirdParty.preg_quote=function(a){return(a+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")},a.init=function(b){b?a.parseSerialization(b):window.addEventListener("DOMContentLoaded",function(){a.parseSerialization(a.serialization=document.querySelector(a.SERIALIZATION_QUERY))})},window.indexedDB||a.browser.isSafari?(a.serialization||window.addEventListener("DOMContentLoaded",function(){a.serialization=document.querySelector(a.SERIALIZATION_QUERY)}),a.initLocalDb(a.CACHING_DB_VERSION,function(b){a.init(a.serialization)})):a.init(a.serialization)}()));