"undefined"!=typeof window&&(window.Requestr||!function(){"use strict";window.URL=window.URL||window.webkitURL;var a=window.Requestr={};a.LOADING_CLASS="requestr",a.ELEMENTS_QUERY='[rel~="stylesheet"][href], [rel~="icon"][href], [src]',a.SERIALIZATION_QUERY='script[type="text/requestr-serialization"]',a.JS_ELEMENT_ATTRIBUTE="data-requestr-js",a.DEFAULT_SERVICE_FILE_MAX_SIZE=1e5,a.serialization=document.querySelector(a.SERIALIZATION_QUERY),a.onEvent=null,a.urlParsingEnabledElement={IMG:!0,LINK:!0,SCRIPT:!0},a.customEvents={REQUESTR_READY:"requestrReady",DOCUMENT_LOAD_START:"documentLoadStart",DOCUMENT_LOAD_PROGRESS:"documentLoadProgress",DOCUMENT_LOAD_ERROR:"documentLoadError",DOCUMENT_LOAD_COMPLETE:"documentLoadComplete",DOCUMENT_RENDERED:"documentRendered",RESOURCE_API_ERROR:"resourceApiError",RESOURCE_LOAD_START:"resourceLoadStart",RESOURCE_LOAD_PROGRESS:"resourceLoadProgress",RESOURCE_LOAD_ERROR:"resourceLoadError",RESOURCE_LOAD_COMPLETE:"resourceLoadComplete",RESOURCE_RESOLVING:"resourceResolving"},a.dispatchCustomEvent=function(b,c){"function"==typeof a.onEvent&&a.onEvent(c?new CustomEvent(b,{detail:c}):new CustomEvent(b))},a.stopWindow=function(){window.stop()},a.loadPage=function(b,c){document.documentElement.classList.add(a.LOADING_CLASS),a.stopWindow(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_START),a.xhr=new XMLHttpRequest,a.xhr.open("GET",b,!0),c&&(a.xhr.blobUrlCallback=c),a.xhr.addEventListener("load",a.parsePage,!0),a.xhr.addEventListener("progress",a.pageLoadProgress,!0),a.xhr.addEventListener("error",a.pageLoadError,!0),a.xhr.addEventListener("abort",a.pageLoadAbort,!0),a.xhr.responseType="document",a.xhr.send()},a.removePageLoadXhrListeners=function(){a.xhr.removeEventListener("load",a.parsePage,!0),a.xhr.removeEventListener("progress",a.pageLoadProgress,!0),a.xhr.removeEventListener("error",a.pageLoadError,!0),a.xhr.removeEventListener("abort",a.pageLoadAbort,!0)},a.pageLoadProgress=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_PROGRESS,{progress:Math.round(100*(b.loaded/b.totalSize))})},a.pageLoadError=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.pageLoadAbort=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.parsePage=function(b){if(a.service){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_COMPLETE),a.removePageLoadXhrListeners(),a.ownerDocument=b.target.response;var c,d,e,f,g,h,i=[],j=[],k=a.ownerDocument.querySelectorAll(a.ELEMENTS_QUERY);for(c=0,d=k.length;e=k[c];c++)a.urlParsingEnabledElement[e.nodeName]&&(i.push({Url:e.src||e.href,Token:null}),e.src?e.setAttribute("src",e.src):e.href&&e.setAttribute("href",e.href),j.push({resolvedValue:e.src||e.href,originalValue:e.getAttribute("src")||e.getAttribute("href"),attribute:e.src?"src":e.href?"href":null}));0===(g=a.ownerDocument.getElementsByTagName("base")).length&&(g=a.ownerDocument.createElement("base"),g.setAttribute("href",a.ownerDocument.URL),a.ownerDocument.head.appendChild(g)),(h=a.ownerDocument.querySelector(a.SERIALIZATION_QUERY))&&h.parentNode.removeChild(h),(h=a.ownerDocument.querySelector("["+a.JS_ELEMENT_ATTRIBUTE+"]"))&&h.parentNode.removeChild(h),a.documentString=a.ownerDocument.documentElement.outerHTML,a.xhr.blobUrlCallback&&(f=a.xhr.blobUrlCallback),a.xhr=new XMLHttpRequest,a.xhr.open("POST",a.service,!0),a.xhr.setRequestHeader("Content-type","application/json"),a.xhr.setRequestHeader("Accept","application/json"),f&&(a.xhr.blobUrlCallback=f);try{a.xhr.responseType="json"}catch(l){}a.xhr.addEventListener("load",a.handleResponseResources,!0),a.xhr.addEventListener("error",a.handleResponseResourcesError,!0),a.xhr.addEventListener("progress",a.handleResponseResourcesProgress,!0),a.xhr.addEventListener("abort",a.handleResponseResourcesAbort,!0),a.xhr.send(JSON.stringify({MaxSize:(a.serialization?a.serialization.maxFileSize:null)||a.DEFAULT_SERVICE_FILE_MAX_SIZE,Urls:i})),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_START)}},a.removeResponseLoadXhrListener=function(){a.xhr.removeEventListener("load",a.handleResponseResources,!0),a.xhr.removeEventListener("error",a.handleResponseResourcesError,!0),a.xhr.removeEventListener("progress",a.handleResponseResourcesProgress,!0),a.xhr.removeEventListener("abort",a.handleResponseResourcesAbort,!0)},a.handleResponseResources=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_COMPLETE),a.removeResponseLoadXhrListener(),"object"!=typeof b.target.response&&(b.target.response=JSON.parse(b.target.response));var c,d,e,f,g,h=b.target.response,i=a.documentString,j=h.Resources,k=window.document.implementation.createHTMLDocument("");if(h.Resources||a.dispatchCustomEvent(a.customEvents.RESOURCE_API_ERROR),k.documentElement.innerHTML=i,a.dispatchCustomEvent(a.customEvents.RESOURCE_RESOLVING),j)for(c=0;f=j[c];c++){var l,m=a.dataURItoBlob(f.Data,f.ContentType);for(l=window.URL.createObjectURL(m),g=k.querySelectorAll('[src="'+f.Url+'"], [href="'+f.Url+'"]'),d=0;e=g[d];d++)e.src&&e.setAttribute("src",l),e.href&&e.setAttribute("href",l)}a.xhr.blobUrlCallback?(a.createDocumentBlobUrl(k,a.ownerDocument,a.xhr.blobUrlCallback),document.documentElement.classList.remove(a.LOADING_CLASS)):a.setDocumentHtml(a.ownerDocument,k.documentElement.outerHTML),a.xhr=null},a.handleResponseResourcesProgress=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleResponseResourcesAbort=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b})},a.handleResponseResourcesError=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b}),a.setDocumentHtml(a.ownerDocument,a.documentString)},a.dataURItoBlob=function(a,b){var c,d=[],e=atob(a.split(",")[1]),f=e.length;for(c=0;f>c;c++)d.push(e.charCodeAt(c));return new Blob([new Uint8Array(d)],{type:b?b:"text/plain"})},a.setDocumentHtml=function(b,c){var d,e,f,g=window.document.implementation.createHTMLDocument("");for(g.documentElement.innerHTML=c,a.setDocumentElementAttributes(document.documentElement,b.documentElement),document.documentElement.innerHTML=c,e=document.querySelectorAll("script"),d=0;f=e[d];d++){var h=document.createElement("script");a.duplicateElementAttributes(f,h),h.textContent=f.textContent||f.innerText,f.parentNode.insertBefore(h,f),f.parentNode.removeChild(f)}document.documentElement.classList.remove(a.LOADING_CLASS),window.dispatchEvent(new CustomEvent("load")),a.dispatchCustomEvent(a.customEvents.DOCUMENT_RENDERED,{document:c})},a.createDocumentBlobUrl=function(b,c,d){a.setDocumentElementAttributes(b.documentElement,c.documentElement);var e=window.URL.createObjectURL(a.dataURItoBlob("data:text/html;base64,"+btoa(b.documentElement.outerHTML),"text/html"));"function"==typeof d&&d({url:e,html:b.documentElement.outerHTML})},a.duplicateElementAttributes=function(a,b){var c,d,e,f=a.attributes;for(c=0,d=f.length;d>c;c++)e=f[c],b.setAttribute(e.name,e.value)},a.setDocumentElementAttributes=function(b,c){var d,e,f,g;for(d=b.attributes,e=0,f=d.length;f>e;e++)g=d[e],g&&b.removeAttribute(g.name);a.duplicateElementAttributes(c,b),d=g=e=f=null},a.getDocType=function(a){return"<!DOCTYPE "+a.name+(a.publicId?' PUBLIC "'+a.publicId+'"':"")+(!a.publicId&&a.systemId?" SYSTEM":"")+(a.systemId?' "'+a.systemId+'"':"")+">"},window.dispatchEvent(new CustomEvent(a.customEvents.REQUESTR_READY)),a.serialization&&(a.serialization.textContent||a.serialization.innerText)&&(a.serialization=JSON.parse(a.serialization.textContent||a.serialization.innerText),a.serialization&&a.serialization.service&&(a.service=a.serialization.service),a.serialization&&a.serialization.self?a.loadPage(window.location.href):a.serialization&&a.serialization.owner&&a.loadPage(a.serialization.owner))}());