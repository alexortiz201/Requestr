"undefined"!=typeof window&&(window.Requestr||!function(){"use strict";window.URL=window.URL||window.webkitURL;var a=window.Requestr={};a.LOADING_CLASS="requestr",a.ELEMENTS_QUERY='[rel~="stylesheet"][href], [rel~="icon"][href], [src]',a.SERIALIZATION_QUERY='script[type="text/requestr-serialization"]',a.JS_ELEMENT_ATTRIBUTE="data-requestr-js",a.DEFAULT_SERVICE_FILE_MAX_SIZE=4e4,a.serialization=document.querySelector(a.SERIALIZATION_QUERY),a.onEvent=null,a.urlParsingEnabledElement={IMG:!0,LINK:!0,SCRIPT:!0},a.resolvedUrls=[],a.thirdParty={},a.customEvents={REQUESTR_READY:"requestrReady",DOCUMENT_LOAD_START:"documentLoadStart",DOCUMENT_LOAD_PROGRESS:"documentLoadProgress",DOCUMENT_LOAD_ERROR:"documentLoadError",DOCUMENT_LOAD_COMPLETE:"documentLoadComplete",DOCUMENT_RENDERED:"documentRendered",DOCUMENT_BLOB_URL_CREATED:"documentBlobUrlCreated",RESOURCE_API_ERROR:"resourceApiError",RESOURCE_LOAD_START:"resourceLoadStart",RESOURCE_LOAD_PROGRESS:"resourceLoadProgress",RESOURCE_LOAD_ERROR:"resourceLoadError",RESOURCE_LOAD_COMPLETE:"resourceLoadComplete",RESOURCE_RESOLVING:"resourceResolving",EXTERNAL_CSS_LOAD_START:"externalCssLoadStart",EXTERNAL_CSS_LOAD_COMPLETE:"externalCssLoadComplete",EXTERNAL_CSS_LOAD_PROGRESS:"externalCssLoadProgress",EXTERNAL_CSS_LOAD_ERROR:"externalCssLoadError"},a.dispatchCustomEvent=function(b,c){"function"==typeof a.onEvent&&a.onEvent(c?new CustomEvent(b,{detail:c}):new CustomEvent(b))},a.stopWindow=function(){window.stop()},a.parseSerialization=function(b){b&&(b.textContent||b.innerText)&&(b=JSON.parse(b.textContent||b.innerText),b&&b.service&&(a.service=b.service),window.dispatchEvent(new CustomEvent(a.customEvents.REQUESTR_READY)),b&&b.self?a.loadPage(window.location.href):b&&b.owner&&a.loadPage(b.owner))},a.loadPage=function(b,c){document.documentElement.classList.add(a.LOADING_CLASS),a.stopWindow(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_START);var d=document.createElement("a");d.setAttribute("href",b),d=d.href,0===d.indexOf(window.location.origin)?(a.xhr=new XMLHttpRequest,a.xhr.open("GET",b,!0),c&&(a.xhr.blobUrlCallback=c),a.xhr.addEventListener("load",a.parsePage,!0),a.xhr.addEventListener("progress",a.pageLoadProgress,!0),a.xhr.addEventListener("error",a.pageLoadError,!0),a.xhr.addEventListener("abort",a.pageLoadAbort,!0),a.xhr.responseType="document",a.xhr.send()):a.service?a.requestDataUriFromService(a.service,[{Url:d,Token:null,Type:"STRING"}],{load:function(b){var e=b.target.response;if(e&&(e=b.target.response.Resources)&&(e=e[0])){var f,g=window.document.implementation.createHTMLDocument("");g.documentElement.innerHTML=e.Data,0===(f=g.getElementsByTagName("base")).length&&(f=g.createElement("base"),f.setAttribute("href",d),g.head.appendChild(f)),a.parsePage({target:{response:g}},c)}else console.log("Error: Service API did not return a document!")},error:null,progress:null,abort:null},null,2e6):console.log("Error: Cannot load page. Page is not relative and no service API was specified.")},a.removePageLoadXhrListeners=function(){a.xhr.removeEventListener("load",a.parsePage,!0),a.xhr.removeEventListener("progress",a.pageLoadProgress,!0),a.xhr.removeEventListener("error",a.pageLoadError,!0),a.xhr.removeEventListener("abort",a.pageLoadAbort,!0)},a.pageLoadProgress=function(b){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_PROGRESS,{progress:Math.round(100*(b.loaded/b.totalSize)),bytes:b.loaded,total:b.totalSize})},a.pageLoadError=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.pageLoadAbort=function(b){a.removePageLoadXhrListeners(),a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_ERROR,{error:b})},a.parsePage=function(b,c){if(a.service){a.dispatchCustomEvent(a.customEvents.DOCUMENT_LOAD_COMPLETE),a.removePageLoadXhrListeners(),a.ownerDocument=b.target.response;var d,e,f,g,h,i,j,k,l,m=[],n=a.ownerDocument.querySelectorAll(a.ELEMENTS_QUERY);for(d=0,f=n.length;h=n[d];d++)a.urlParsingEnabledElement[h.nodeName]&&(1===h.nodeType&&"LINK"===h.nodeName&&h.href?m.push({Url:h.href,Token:null,Type:"STRING"}):m.push({Url:h.src||h.href,Token:null}),h.src?h.setAttribute("src",h.src):h.href&&h.setAttribute("href",h.href));for(0===(i=a.ownerDocument.getElementsByTagName("base")).length&&(i=a.ownerDocument.createElement("base"),i.setAttribute("href",a.ownerDocument.URL),a.ownerDocument.head.appendChild(i)),(j=a.ownerDocument.querySelector(a.SERIALIZATION_QUERY))&&j.parentNode.removeChild(j),(j=a.ownerDocument.querySelector("["+a.JS_ELEMENT_ATTRIBUTE+"]"))&&j.parentNode.removeChild(j),n=a.ownerDocument.getElementsByTagName("style"),d=0,f=n.length;h=n[d];d++)if(h.sheet){if(k=a.getParseCssFromRules(h.sheet.rules),h.innerText?h.innerText=k:h.textContent&&(h.textContent=k),l=a.getUrlsFromCssString(k))for(e=0,g=l.length;g>e;e++)m.push({Url:l[e],Token:null})}else console.log("Error: Style element did not have a valid sheet property!");a.documentString=a.ownerDocument.documentElement.outerHTML,a.xhr.blobUrlCallback&&(c=a.xhr.blobUrlCallback),a.requestDataUriFromService(a.service,m,{load:a.handleResponseResources,error:a.handleResponseResourcesError,progress:a.handleResponseResourcesProgress,abort:a.handleResponseResourcesAbort},c),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_START)}},a.requestDataUriFromService=function(b,c,d,e,f){a.xhr=new XMLHttpRequest,a.xhr.open("POST",b,!0),a.xhr.setRequestHeader("Content-type","application/json"),a.xhr.setRequestHeader("Accept","application/json"),e&&(a.xhr.blobUrlCallback=e);try{a.xhr.responseType="json"}catch(g){}d&&("function"==typeof d.load&&a.xhr.addEventListener("load",d.load,!0),"function"==typeof d.error&&a.xhr.addEventListener("error",d.error,!0),"function"==typeof d.progress&&a.xhr.addEventListener("progress",d.progress,!0),"function"==typeof d.abort&&a.xhr.addEventListener("abort",d.abort,!0)),a.xhr.send(JSON.stringify({MaxSize:f||(a.serialization?a.serialization.maxFileSize:null)||a.DEFAULT_SERVICE_FILE_MAX_SIZE,Urls:c}))},a.getParseCssFromRules=function(b){if(b){var c,d=b.length,e="";for(c=0;d>c;c++)e+=b[c].cssText;return a.getNormalizedCssString(e)}return null},a.getNormalizedCssString=function(a){return a.replace(/background\-position\: initial initial;/gi,"").replace(/background\-repeat\: initial initial;/gi,"")},a.getUrlsFromCssString=function(a){var b=a.match(/url\(()(.+?)\1\)/gi);return b=Array.isArray(b)?b.toString().match(/(\b(?:(?:https?|ftp|file|[A-Za-z]+):\/\/|www\.|ftp\.)(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[-A-Z0-9+&@#\/%=~_|$?!:,.])*(?:\([-A-Z0-9+&@#\/%=~_|$?!:,.]*\)|[A-Z0-9+&@#\/%=~_|$]))/gi):null},a.removeResponseLoadXhrListener=function(){a.xhr.removeEventListener("load",a.handleResponseResources,!0),a.xhr.removeEventListener("error",a.handleResponseResourcesError,!0),a.xhr.removeEventListener("progress",a.handleResponseResourcesProgress,!0),a.xhr.removeEventListener("abort",a.handleResponseResourcesAbort,!0)},a.handleResponseResources=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_COMPLETE),a.removeResponseLoadXhrListener(),b="object"!=typeof b.target.response?JSON.parse(b.target.response):b.target.response;var c,d,e,f,g=b,h=a.documentString,i=[],j=g.Resources,k=window.document.implementation.createHTMLDocument(""),l=a.xhr.blobUrlCallback;if(g.Resources||a.dispatchCustomEvent(a.customEvents.RESOURCE_API_ERROR),k.documentElement.innerHTML=h,a.dispatchCustomEvent(a.customEvents.RESOURCE_RESOLVING),c=k.getElementsByTagName("style"),j){for(d=0;f=j[d];d++)"text/css"===f.ContentType&&"STRING"===f.Type?i.push(f):a.replaceDocumentUrlsWithBlob(f,k,c);e=a.parseCssResourcesForUrls(i)}i.length>0&&e&&e.length>0?a.loadExternalCssUrls(e,i,k,c,function(){a.completeResolvingDocument(k,a.ownerDocument,l)}):a.completeResolvingDocument(k,a.ownerDocument,l),a.xhr=null},a.completeResolvingDocument=function(b,c,d){d&&"function"==typeof d?(a.createDocumentBlobUrl(b,c,d),document.documentElement.classList.remove(a.LOADING_CLASS)):a.setDocumentHtml(c,b.documentElement.outerHTML)},a.loadExternalCssUrls=function(b,c,d,e,f){var g,h,i=b.length,j=[];for(g=0;i>g;g++)h=b[g],a.resolvedUrls[h]||j.push({Url:h,Token:null});0===j.length?a.resolveDocumentCssUrls(c,d,e,f):(a.requestDataUriFromService(a.service,j,{progress:a.handleExternalCssProgress,load:function(b){a.handleDocumentCssUris(b,c,d,e,f)},error:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,d,e,f)},abort:function(b){a.handleExternalCssResourcesError(b),a.resolveDocumentCssUrls(c,d,e,f)}}),a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_START))},a.handleExternalCssProgress=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleExternalCssResourcesError=function(b){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_ERROR,{error:b})},a.handleDocumentCssUris=function(b,c,d,e,f){a.dispatchCustomEvent(a.customEvents.EXTERNAL_CSS_LOAD_COMPLETE);var g,h,i,j,k=b.target.response.Resources;if(k){for(g=0;h=k[g];g++)"text/css"===h.ContentType&&"STRING"===h.Type?j.push(h):a.createUrlFromResource(h);i=a.parseCssResourcesForUrls(j)}i?console.log("Error: CSS imports not currently supported!"):a.resolveDocumentCssUrls(c,d,e,f)},a.resolveDocumentCssUrls=function(b,c,d,e){var f,g,h,i=a.resolvedUrls;for(g=0;h=b[g];g++){for(f in i)h.Data=h.Data.replace(new RegExp(a.thirdParty.preg_quote(f),"gi"),i[f]);a.replaceDocumentUrlsWithBlob(h,c,d)}"function"==typeof e&&e()},a.parseCssResourcesForUrls=function(b){var c,d,e,f,g,h=[],i=Array.isArray(b)?b.length:0;if(i>0){for(f=0;i>f;f++)e=window.document.implementation.createHTMLDocument(""),d=e.createElement("base"),c=e.createElement("style"),d.setAttribute("href",b[f].Url),c.innerHTML=b[f].Data,e.head.appendChild(d),e.head.appendChild(c),c.sheet&&(g=a.getUrlsFromCssString(b[f].Data=a.getParseCssFromRules(c.sheet.cssRules)),g&&(h=h.concat(g))),e=d=c=null;return h}},a.createUrlFromResource=function(b){var c="STRING"===b.Type?a.dataStringToBlob(b.Data,b.ContentType):a.dataURItoBlob(b.Data,b.ContentType);return a.resolvedUrls[b.Url]=window.URL.createObjectURL(c)},a.replaceDocumentUrlsWithBlob=function(b,c,d){var e,f,g,h,i,j=a.createUrlFromResource(b);for(h=c.querySelectorAll('[src="'+b.Url+'"], [href="'+b.Url+'"]'),e=0;g=h[e];e++)g.src&&g.setAttribute("src",j),g.href&&g.setAttribute("href",j);for(f=0;i=d[f];f++)i.innerText?i.innerText=i.innerText.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j):i.textContent&&(i.textContent=i.textContent.replace(new RegExp(a.thirdParty.preg_quote(b.Url),"gi"),j))},a.handleResponseResourcesProgress=function(b){a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_PROGRESS,{bytes:Math.round(b.loaded)})},a.handleResponseResourcesAbort=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b})},a.handleResponseResourcesError=function(b){a.removeResponseLoadXhrListener(),a.dispatchCustomEvent(a.customEvents.RESOURCE_LOAD_ERROR,{error:b}),a.setDocumentHtml(a.ownerDocument,a.documentString)},a.dataURItoBlob=function(a,b){var c,d=[],e=atob(a.split(",")[1]),f=e.length;for(c=0;f>c;c++)d.push(e.charCodeAt(c));return new Blob([new Uint8Array(d)],{type:b?b:"text/plain"})},a.dataStringToBlob=function(b,c){return a.dataURItoBlob("data:"+c+";base64,"+btoa(unescape(encodeURIComponent(b))),c)},a.setDocumentHtml=function(b,c){var d,e,f,g=window.document.implementation.createHTMLDocument("");for(g.documentElement.innerHTML=c,a.setDocumentElementAttributes(document.documentElement,b.documentElement),document.documentElement.innerHTML=c,e=document.querySelectorAll("script"),d=0;f=e[d];d++){var h=document.createElement("script");a.duplicateElementAttributes(f,h),h.textContent=f.textContent||f.innerText,f.parentNode.insertBefore(h,f),f.parentNode.removeChild(f)}document.documentElement.classList.remove(a.LOADING_CLASS),window.dispatchEvent(new CustomEvent("load")),a.dispatchCustomEvent(a.customEvents.DOCUMENT_RENDERED,{document:c})},a.createDocumentBlobUrl=function(b,c,d){a.setDocumentElementAttributes(b.documentElement,c.documentElement);var e=window.URL.createObjectURL(a.dataStringToBlob(b.documentElement.outerHTML,"text/html"));"function"==typeof d&&(d({url:e,html:b.documentElement.outerHTML}),a.dispatchCustomEvent(a.customEvents.DOCUMENT_BLOB_URL_CREATED,{url:e,html:b.documentElement.outerHTML}))},a.duplicateElementAttributes=function(a,b){var c,d,e,f=a.attributes;for(c=0,d=f.length;d>c;c++)e=f[c],b.setAttribute(e.name,e.value)},a.setDocumentElementAttributes=function(b,c){var d,e,f,g;for(d=b.attributes,e=0,f=d.length;f>e;e++)g=d[e],g&&b.removeAttribute(g.name);a.duplicateElementAttributes(c,b),d=g=e=f=null},a.thirdParty.preg_quote=function(a){return(a+"").replace(new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g"),"\\$&")},a.serialization?a.parseSerialization(a.serialization):window.addEventListener("DOMContentLoaded",function(){a.parseSerialization(a.serialization=document.querySelector(a.SERIALIZATION_QUERY))})}());